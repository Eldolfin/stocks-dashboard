FROM denoland/deno:alpine AS builder
RUN apk add --no-cache curl
WORKDIR /app
EXPOSE 3000
ENV NODE_ENV=production

COPY package.json deno.lock .
COPY svelte.config.js .
RUN deno install --allow-scripts=npm:@tailwindcss/oxide@4.1.11
RUN deno task prepare
COPY . .
RUN deno task build

CMD [ "deno", "--allow-env", "--allow-read", "--allow-net", "build/index.js" ]
HEALTHCHECK CMD curl -f -o /dev/null http://localhost:3000
